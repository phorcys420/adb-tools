(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{6685:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return i(2221)}])},2060:function(e,t,i){"use strict";i.d(t,{X:function(){return r}});var o=i(3546),n=i(4084);function r(){let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let t=e.parentElement,i=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=i}},[e]),(0,o.jsx)("div",{ref:t})}},2221:function(e,t,i){"use strict";let o;i.r(t),i.d(t,{default:function(){return eH}});var n=i(3546),r=i(1425),a=i(732),s=i(2844),d=i(7750),l=i(5362),c=i(8672),h=i(967),u=i(9251),p=i(4210),g=i(1723),f=i(9244),y=i(4513),v=i(2517),m=i(1768),w=i.n(m),b=i(4084),S=i(2137),k=i(5612),C=i(5786),x=i(4812),P=i(2274),D=i(2060),L=i(9529);let E={[x.WP.H264]:"V_MPEG4/ISO/AVC",[x.WP.H265]:"V_MPEGH/ISO/HEVC",[x.WP.AV1]:"V_AV1"},_={[x.$e.RAW.mimeType]:"A_PCM/INT/LIT",[x.$e.AAC.mimeType]:"A_AAC",[x.$e.OPUS.mimeType]:"A_OPUS"};class A{addVideoChunk(e){-1===this._firstTimestamp&&(this._firstTimestamp=Number(e.pts));let t=function(e){let t=[],i=0;for(let o of(0,x.qC)(e))t.push(o),i+=o.byteLength+4;let o=new Uint8Array(i),n=0;for(let e of t)o[n]=e.byteLength>>24,o[n+1]=e.byteLength>>16,o[n+2]=e.byteLength>>8,o[n+3]=255&e.byteLength,o.set(e,n+4),n+=4+e.byteLength;return o}(e.data);this.muxer.addVideoChunkRaw(t,e.keyframe?"key":"delta",Number(e.pts)-this._firstTimestamp,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.videoCodecDescription}}),this.configurationWritten=!0}addVideoPacket(e){if(!this.videoMetadata)throw Error("videoMetadata must be set");try{if("configuration"===e.type){switch(this.videoMetadata.codec){case x.WP.H264:{let{sequenceParameterSet:t,pictureParameterSet:i}=(0,x.MN)(e.data);this.videoCodecDescription=function(e,t){let i=new Uint8Array(11+e.byteLength+t.byteLength);return i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225,i[6]=e.byteLength>>8,i[7]=255&e.byteLength,i.set(e,8),i[8+e.byteLength]=1,i[9+e.byteLength]=t.byteLength>>8,i[10+e.byteLength]=255&t.byteLength,i.set(t,11+e.byteLength),i}(t,i),this.configurationWritten=!1;break}case x.WP.H265:{let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:o}=(0,x.mc)(e.data);this.videoCodecDescription=function(e,t,i){let{profileTierLevel:{generalProfileTier:{profile_space:o,tier_flag:n,profile_idc:r,profileCompatibilitySet:a,constraintSet:s},general_level_idc:d},vps_max_layers_minus1:l,vps_temporal_id_nesting_flag:c}=(0,x.r_)(e.rbsp),{chroma_format_idc:h,bit_depth_luma_minus8:u,bit_depth_chroma_minus8:p,vuiParameters:{min_spatial_segmentation_idc:g=0}={}}=(0,x.tW)(t.rbsp),f=new Uint8Array(38+e.data.length+t.data.length+i.data.length);f[0]=1,f[1]=o<<6|Number(n)<<5|r,f[2]=a[0],f[3]=a[1],f[4]=a[2],f[5]=a[3],f[6]=s[0],f[7]=s[1],f[8]=s[2],f[9]=s[3],f[10]=s[4],f[11]=s[5],f[12]=d,f[13]=240|g>>8,f[14]=g,f[15]=252,f[16]=252|h,f[17]=248|u,f[18]=248|p,f[19]=0,f[20]=0,f[21]=l+1<<3|Number(c)<<2|3,f[22]=3;let y=23;for(let o of[e,t,i])f[y]=o.nal_unit_type,f[y+=1]=0,f[y+=1]=1,f[y+=1]=o.data.length>>8,f[y+=1]=o.data.length,y+=1,f.set(o.data,y),y+=o.data.length;return f}(t,i,o),this.configurationWritten=!1}}return}if(!0===e.keyframe&&(this._packetsFromLastKeyframe.length=0),this._packetsFromLastKeyframe.push({type:"video",packet:e}),!this.muxer)return;this.addVideoChunk(e)}catch(e){console.error(e)}}addAudioChunk(e){if(-1===this._firstTimestamp)return;let t=Number(e.pts)-this._firstTimestamp;!(t<0)&&this.muxer&&this.muxer.addAudioChunkRaw(e.data,"key",t)}addAudioPacket(e){this._packetsFromLastKeyframe.push({type:"audio",packet:e}),this.addAudioChunk(e)}start(){var e,t;if(!this.videoMetadata)throw Error("videoMetadata must be set");this.running=!0;let i={target:new L.tz,type:"matroska",firstTimestampBehavior:"permissive",video:{codec:E[this.videoMetadata.codec],width:null!==(e=this.videoMetadata.width)&&void 0!==e?e:0,height:null!==(t=this.videoMetadata.height)&&void 0!==t?t:0}};if(this.audioCodec&&(i.audio={codec:_[this.audioCodec.mimeType],sampleRate:48e3,numberOfChannels:2,bitDepth:this.audioCodec===x.$e.RAW?16:void 0}),this.muxer=new L.fX(i),this._packetsFromLastKeyframe.length>0)for(let{type:e,packet:t}of this._packetsFromLastKeyframe)"video"===e?this.addVideoChunk(t):this.addAudioChunk(t)}stop(){if(!this.muxer)return;this.muxer.finalize();let e=this.muxer.target.buffer,t=new Date,i=(0,P.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".mkv")),o=i.getWriter();o.write(new Uint8Array(e)),o.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1}constructor(){this.running=!1,this.configurationWritten=!1,this._firstTimestamp=-1,this._packetsFromLastKeyframe=[]}}let O=(0,y.ky)({recorder:new A,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,y.U5)(()=>O.recording,e=>{e?O.intervalId=globalThis.setInterval((0,y.aD)(()=>{O.seconds+=1,O.seconds>=60&&(O.seconds=0,O.minutes+=1),O.minutes>=60&&(O.minutes=0,O.hours+=1)}),1e3):(globalThis.clearInterval(O.intervalId),O.intervalId=-1,O.hours=0,O.minutes=0,O.seconds=0)});var z=i(8157),j=i(2526),T=i(4579),M=i(7237),V=i(6117),R=i(2611),N=i(461);class I extends R.GJ{constructor(e){let t;super({start(e){t=new AudioDecoder({error(t){console.log("audio decoder error: ",t),e.error(t)},output(t){e.enqueue(Array.from({length:2},(e,i)=>{let o={format:"f32-planar",planeIndex:i},n=new Float32Array(t.allocationSize(o)/Float32Array.BYTES_PER_ELEMENT);return t.copyTo(n,o),n}))}})},transform(i){switch(i.type){case"configuration":t.configure({...e,description:i.data});break;case"data":t.decode(new EncodedAudioChunk({data:i.data,type:"key",timestamp:0}))}},async flush(){await t.flush()}})}}class H extends R.GJ{constructor(e){let t;super({start(i){(t=new AudioDecoder({error(e){console.log("audio decoder error: ",e),i.error(e)},output(e){let t={format:"f32",planeIndex:0},o=new Float32Array(e.allocationSize(t)/Float32Array.BYTES_PER_ELEMENT);e.copyTo(o,t),i.enqueue(o)}})).configure(e)},transform(e){switch(e.type){case"configuration":break;case"data":if(0===e.data.length)break;t.decode(new EncodedAudioChunk({type:"key",timestamp:0,data:e.data}))}},async flush(){await t.flush()}})}}var U=i(4789);class W{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let i=await globalThis.fetch(e);this._total=Number.parseInt(null!==(t=i.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let o=i.body.getReader(),n=[];for(;;){let e=await o.read();if(e.done)break;n.push(e.value),this._downloaded+=e.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let r=new Uint8Array(this._total),a=0;for(let e of n)r.set(e,a),a+=e.byteLength;return r}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new U.vp,this.promise=this.fetch(e)}}function K(e){return o||(o=new W(M.q)).promise.catch(()=>{o=void 0}),e&&(o.onProgress(e),e([o.downloaded,o.total])),o.promise}var F=i(8937);class Y{setModifier(e,t){switch(e){case x.AY.ControlLeft:this._controlLeft=t;break;case x.AY.ControlRight:this._controlRight=t;break;case x.AY.ShiftLeft:this._shiftLeft=t;break;case x.AY.ShiftRight:this._shiftRight=t;break;case x.AY.AltLeft:this._altLeft=t;break;case x.AY.AltRight:this._altRight=t;break;case x.AY.MetaLeft:this._metaLeft=t;break;case x.AY.MetaRight:this._metaRight=t;break;case x.AY.CapsLock:t&&(this._capsLock=!this._capsLock);break;case x.AY.NumLock:t&&(this._numLock=!this._numLock)}}getMetaState(){let e=0;return this._altLeft&&(e|=x.OV.AltOn|x.OV.AltLeftOn),this._altRight&&(e|=x.OV.AltOn|x.OV.AltRightOn),this._shiftLeft&&(e|=x.OV.ShiftOn|x.OV.ShiftLeftOn),this._shiftRight&&(e|=x.OV.ShiftOn|x.OV.ShiftRightOn),this._controlLeft&&(e|=x.OV.CtrlOn|x.OV.CtrlLeftOn),this._controlRight&&(e|=x.OV.CtrlOn|x.OV.CtrlRightOn),this._metaLeft&&(e|=x.OV.MetaOn|x.OV.MetaLeftOn),this._metaRight&&(e|=x.OV.MetaOn|x.OV.MetaRightOn),this._capsLock&&(e|=x.OV.CapsLockOn),this._numLock&&(e|=x.OV.NumLockOn),e}async down(e){var t;let i=x.AY[e];i&&(this.setModifier(i,!0),this._keys.add(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:x.vH.Down,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async up(e){var t;let i=x.AY[e];i&&(this.setModifier(i,!1),this._keys.delete(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:x.vH.Up,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async reset(){for(let e of(this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._keys))this.up(x.AY[e]);this._keys.clear()}dispose(){}constructor(e){this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._capsLock=!1,this._numLock=!0,this._keys=new Set,this.client=e}}class J{static async register(e){let t=await F.qG.register(e,0,F.XC.DESCRIPTOR);return new J(t)}async down(e){let t=F.sm[e];t&&(this.hidKeyboard.down(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async up(e){let t=F.sm[e];t&&(this.hidKeyboard.up(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async reset(){this.hidKeyboard.reset(),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport())}async dispose(){await this.aoaKeyboard.unregister()}constructor(e){this.hidKeyboard=new F.XC,this.aoaKeyboard=e}}var q=i(6493),B=i(1646),X=i(3069),G=i(184),Z=i(7624),$=i(6087),Q=i(3589),ee=i(2807),et=i(5457);let ei=(0,p.Z)({labelRight:{marginLeft:"4px"},item:{width:"100%",maxWidth:"300px"}}),eo=(0,v.Pi)(function(e){let{definition:t,value:i,onChange:o}=e,r=ei(),a=(0,n.jsxs)(s.K,{horizontal:!0,verticalAlign:"center",children:[(0,n.jsx)("span",{children:t.label}),!!t.description&&(0,n.jsx)(q.G,{content:t.description,children:(0,n.jsx)(B.J,{className:r.labelRight,iconName:P.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,n.jsx)(X.n,{className:r.item,label:a,placeholder:t.placeholder,value:i,onChange:(e,i)=>o(t,i)});case"dropdown":return(0,n.jsx)(G.L,{className:r.item,label:a,options:t.options,placeholder:t.placeholder,selectedKey:i,onChange:(e,i)=>o(t,i.key)});case"toggle":return(0,n.jsx)(Z.Z,{label:a,checked:i,disabled:t.disabled,onChange:(e,i)=>o(t,i)});case"number":return(0,n.jsx)($.k,{className:r.item,label:t.label,labelPosition:Q.L.top,min:t.min,max:t.max,step:t.step,value:i.toString(),onChange:(e,i)=>o(t,Number.parseInt(i,10))})}}),en={maxSize:1080,videoBitRate:4e6,videoCodec:"h264",lockVideoOrientation:x.J4.Unlocked,displayId:0,crop:"",powerOn:!0,audio:!0,audioCodec:"aac"},er=(0,y.ky)({displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:et.EV}],settings:en,clientSettings:{}},{decoders:y.LO.shallow,settings:y.LO.deep,clientSettings:y.LO.deep}),ea="/data/local/tmp/.tango.json";(0,y.EH)(()=>{N.d.adb&&((async()=>{let e=await N.d.adb.sync();try{let t=await e.read(ea).pipeThrough(new R.xU).pipeThrough(new R.gw),i=JSON.parse(t);i.settings.videoCodecOptions=new x.P3(i.settings.videoCodecOptions),i.settings.audioCodecOptions=new x.P3(i.settings.audioCodecOptions),(0,y.z)(()=>{er.settings={...en,...i.settings},er.clientSettings=i.clientSettings})}catch(e){if(!(e instanceof z.MW))throw e}finally{await e.dispose()}})(),(0,y.z)(()=>{er.encoders=[],er.displays=[],er.settings.displayId=void 0}))}),(0,y.EH)(()=>{er.clientSettings.decoder=er.decoders[0].key});let es=(0,y.Fl)(()=>{let e=[];return e.push({group:"settings",key:"powerOn",type:"toggle",label:"Wake device up on start"},{group:"clientSettings",key:"turnScreenOff",type:"toggle",label:"Turn screen off during mirroring"},{group:"settings",key:"stayAwake",type:"toggle",label:"Stay awake during mirroring (if plugged in)"},{group:"settings",key:"powerOffOnClose",type:"toggle",label:"Turn device off on stop"}),e.push({group:"settings",key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,n.jsx)(ee.h,{iconProps:{iconName:P.PJ.ArrowClockwise},disabled:!N.d.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await T.NE.getDisplays(N.d.adb,x.K1,M.d,new T.vg(new x.qq({logLevel:x.VE.Debug})));(0,y.z)(()=>{if(er.displays=e,!er.settings.displayId||!er.displays.some(e=>e.id===er.settings.displayId)){var t;er.settings.displayId=null===(t=er.displays[0])||void 0===t?void 0:t.id}})}catch(e){N.d.showErrorDialog(e)}}}),options:er.displays.map(e=>({key:e.id,text:"".concat(e.id).concat(e.resolution?" (".concat(e.resolution,")"):"")}))}),e.push({group:"settings",key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({group:"settings",key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50},{group:"settings",key:"videoBitRate",type:"number",label:"Max Video Bitrate (bps)",min:100,max:1e8,step:100},{group:"settings",key:"videoCodec",type:"dropdown",label:"Video Codec",options:[{key:"h264",text:"H.264"},{key:"h265",text:"H.265"}]},{group:"settings",key:"videoEncoder",type:"dropdown",label:"Video Encoder",placeholder:0===er.encoders.length?"Press refresh button to update encoder list":"(default)",labelExtra:(0,n.jsx)(ee.h,{iconProps:{iconName:P.PJ.ArrowClockwise},disabled:!N.d.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await T.NE.getEncoders(N.d.adb,x.K1,M.d,new T.vg(new x.qq({logLevel:x.VE.Debug})));(0,y.z)(()=>{er.encoders=e})}catch(e){N.d.showErrorDialog(e)}}}),options:er.encoders.filter(e=>"video"===e.type&&(!e.codec||e.codec===er.settings.videoCodec)).map(e=>({key:e.name,text:e.name}))}),e.push({group:"settings",key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:x.J4.Unlocked,text:"Unlocked"},{key:x.J4.Initial,text:"Current"},{key:x.J4.Portrait,text:"Portrait"},{key:x.J4.Landscape,text:"Landscape"},{key:x.J4.PortraitFlipped,text:"Portrait (Flipped)"},{key:x.J4.LandscapeFlipped,text:"Landscape (Flipped)"}]}),er.decoders.length>1&&e.push({group:"clientSettings",key:"decoder",type:"dropdown",label:"Video Decoder",options:er.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({group:"clientSettings",key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore video decoder's codec options",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({group:"settings",key:"audio",type:"toggle",label:"Forward Audio (Requires Android 11)"},{group:"settings",key:"audioCodec",type:"dropdown",label:"Audio Codec",options:[{key:"raw",text:"Raw"},{key:"aac",text:"AAC"},{key:"opus",text:"Opus"}]},{group:"settings",key:"audioEncoder",type:"dropdown",placeholder:0===er.encoders.length?"Press refresh button to update encoder list":"(default)",label:"Audio Encoder",labelExtra:(0,n.jsx)(ee.h,{iconProps:{iconName:P.PJ.ArrowClockwise},disabled:!N.d.adb,text:"Refresh",onClick:async()=>{try{await ed.pushServer();let e=await T.NE.getEncoders(N.d.adb,x.K1,M.d,new T.vg(new x.qq({logLevel:x.VE.Debug})));(0,y.z)(()=>{er.encoders=e})}catch(e){N.d.showErrorDialog(e)}}}),options:er.encoders.filter(e=>"audio"===e.type&&e.codec===er.settings.audioCodec).map(e=>({key:e.name,text:e.name}))}),e});(0,y.EH)(()=>{if(0===er.encoders.length){er.settings.videoEncoder="",er.settings.audioEncoder="";return}let e=er.encoders.filter(e=>"video"===e.type&&e.codec===er.settings.videoCodec);er.settings.videoEncoder&&e.every(e=>e.name!==er.settings.videoEncoder)&&(er.settings.videoEncoder="");let t=er.encoders.filter(e=>"audio"===e.type&&e.codec===er.settings.audioCodec);er.settings.audioEncoder&&t.every(e=>e.name!==er.settings.audioEncoder)&&(er.settings.audioEncoder="")});let ed=new class{get rotatedWidth(){return 1&ed.rotation?ed.height:ed.width}get rotatedHeight(){return 1&ed.rotation?ed.width:ed.height}async pushServer(){let e=await K();await T.NE.pushServer(N.d.adb,new R.Pz({start(t){t.enqueue(new R.sS(e)),t.close()}}))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e,t,i;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,O.recording&&(O.recorder.stop(),O.recording=!1),null===(t=this.keyboard)||void 0===t||t.dispose(),this.keyboard=void 0,null===(i=this.audioPlayer)||void 0===i||i.stop(),this.audioPlayer=void 0,this.fps="0",clearTimeout(this.fpsCounterIntervalId),this.isFullScreen&&(document.exitFullscreen(),this.isFullScreen=!1),this.client=void 0,this.running=!1}setFullScreenContainer(e){this.fullScreenContainer=e}setRendererContainer(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let i=this.rendererContainer.getBoundingClientRect(),o=(0,x.uZ)((e-i.x)/i.width,0,1),n=(0,x.uZ)((t-i.y)/i.height,0,1);switch(1&this.rotation&&([o,n]=[n,o]),this.rotation){case 1:n=1-n;break;case 2:o=1-o,n=1-n;break;case 3:o=1-o}return{x:o*this.width,y:n*this.height}}constructor(){this.running=!1,this.fullScreenContainer=null,this.rendererContainer=null,this.isFullScreen=!1,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.keyboard=void 0,this.audioPlayer=void 0,this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps="0",this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(N.d.adb)try{var e,t;let i;if(!er.clientSettings.decoder)throw Error("No available decoder");(0,y.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let o=setInterval((0,y.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{i=await K((0,y.aD)(e=>{let[t,i]=e;this.serverDownloadedSize=t,this.serverTotalSize=i})),(0,y.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(o)}o=setInterval((0,y.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await T.NE.pushServer(N.d.adb,new R.Pz({start(e){e.enqueue(new R.sS(i)),e.close()}}).pipeThrough(new R.em(z.j4)).pipeThrough(new P.hK((0,y.aD)(e=>{this.serverUploadedSize=e})))),(0,y.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(o)}let n=null!==(t=er.decoders.find(e=>e.key===er.clientSettings.decoder))&&void 0!==t?t:er.decoders[0],r=new x.P3;if(!er.clientSettings.ignoreDecoderCodecArgs){let e=n.Constructor.capabilities[er.settings.videoCodec];e&&(r.value.profile=e.maxProfile,r.value.level=e.maxLevel)}let a=new T.vg(new x.qq({...er.settings,logLevel:x.VE.Debug,scid:x.Kn.random(),sendDeviceMeta:!1,sendDummyByte:!1,videoCodecOptions:r}));(0,y.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(M.d)),this.log.push("[client] Server arguments: ".concat(a.serialize().join(" ")))});let s=await T.NE.start(N.d.adb,x.K1,M.d,a);s.stdout.pipeTo(new R.Vj({write:(0,y.aD)(e=>{this.log.push(e)})}));let d=await N.d.adb.sync();try{await d.write({filename:ea,file:new R.Pz({start(e){e.enqueue(new R.sS((0,z.lz)(JSON.stringify({settings:er.settings,clientSettings:er.clientSettings},(e,t)=>t instanceof x.P3?t.value:t)))),e.close()}})})}finally{d.dispose()}O.recorder=new A,s.videoStream.then(e=>{let{stream:t,metadata:i}=e;(0,y.z)(()=>{O.recorder.videoMetadata=i});let o=new n.Constructor(i.codec);(0,y.z)(()=>{this.decoder=o;let e=0,t=0;this.fpsCounterIntervalId=setInterval((0,y.aD)(()=>{let i=o.frameRendered-e,n=o.frameSkipped-t;this.fps="".concat(i).concat(n?"+".concat(n," skipped"):""),e=o.frameRendered,t=o.frameSkipped}),1e3)});let r=0n,a=new R.N7(e=>{if(O.recorder.addVideoPacket(e),"configuration"===e.type){let t,o;switch(i.codec){case x.WP.H264:({croppedWidth:t,croppedHeight:o}=(0,x.VM)(e.data));break;case x.WP.H265:({croppedWidth:t,croppedHeight:o}=(0,x.hA)(e.data));break;default:throw Error("Codec not supported")}(0,y.z)(()=>{this.log.push("[client] Video size changed: ".concat(t,"x").concat(o)),this.width=t,this.height=o})}else if(e.keyframe&&void 0!==e.pts){if(r){let t=Number(e.pts-r)/1e3|0;(0,y.z)(()=>{this.log.push("[client] Keyframe interval: ".concat(t,"ms"))})}r=e.pts}});t.pipeThrough(a).pipeTo(o.writable)}),null===(e=s.audioStream)||void 0===e||e.then(async e=>{switch(e.type){case"disabled":(0,y.z)(()=>this.log.push("[client] Demuxer audio: stream explicitly disabled by the device"));return;case"errored":(0,y.z)(()=>this.log.push("[client] Demuxer audio: stream configuration error on the device"));return;case"success":break;default:throw Error("Unexpected audio metadata type ".concat(e.type))}let[t,i]=e.stream.tee();switch(e.codec){case x.$e.RAW:{let e=new V.ED(48e3);this.audioPlayer=e,i.pipeTo(new R.Vj({write:t=>{e.feed(new Int16Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/Int16Array.BYTES_PER_ELEMENT))}})),await this.audioPlayer.start();break}case x.$e.OPUS:{let t=new V.C(48e3);this.audioPlayer=t,i.pipeThrough(new H({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new R.Vj({write:e=>{t.feed(e)}})),await t.start();break}case x.$e.AAC:{let t=new V.PT(48e3);this.audioPlayer=t,i.pipeThrough(new I({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new R.Vj({write:e=>{t.feed(e)}})),await t.start();break}default:throw Error("Unsupported audio codec ".concat(e.codec.optionValue))}(0,y.z)(()=>{O.recorder.audioCodec=e.codec}),t.pipeTo(new R.Vj({write:e=>{"data"===e.type&&O.recorder.addAudioPacket(e)}}))}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new R.Vj({write(e){e.type===x.L5.Clipboard&&globalThis.navigator.clipboard.writeText(e.content)}})),er.clientSettings.turnScreenOff&&await s.controlMessageWriter.setScreenPowerMode(x.Mr.Off),(0,y.z)(()=>{this.client=s,this.hoverHelper=new x.iX,this.running=!0});let l=N.d.device;l instanceof j.Of?this.keyboard=await J.register(l.raw):this.keyboard=new Y(s)}catch(e){N.d.showErrorDialog(e)}finally{(0,y.z)(()=>{this.connecting=!1})}},(0,y.ky)(this,{start:!1,stop:y.aD.bound,dispose:y.aD.bound,setFullScreenContainer:y.aD.bound,setRendererContainer:y.aD.bound,clientPositionToDevicePosition:!1}),(0,y.EH)(()=>{N.d.adb||this.dispose()}),"object"==typeof document&&document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(0,y.z)(()=>{this.isFullScreen=!1})}),(0,y.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},el=(0,y.Fl)(()=>{let e=[];return e.push({key:"stop",iconProps:{iconName:P.PJ.Stop},text:"Stop",onClick:ed.stop}),e.push(O.recording?{key:"Record",iconProps:{iconName:P.PJ.Record,style:{color:"red"}},text:"".concat(O.hours?"".concat(O.hours,":"):"").concat(O.minutes.toString().padStart(2,"0"),":").concat(O.seconds.toString().padStart(2,"0")),onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),O.recorder.stop(),O.recording=!1})}:{key:"Record",disabled:!ed.running,iconProps:{iconName:P.PJ.Record},text:"Record",onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),O.recorder.start(),O.recording=!0})}),e.push({key:"fullscreen",disabled:!ed.running,iconProps:{iconName:P.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),ed.fullScreenContainer.requestFullscreen(),ed.isFullScreen=!0})}),e.push({key:"volumeUp",disabled:!ed.running,iconProps:{iconName:P.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:x.vH.Down,keyCode:x.AY.VolumeUp,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:x.vH.Up,keyCode:x.AY.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!ed.running,iconProps:{iconName:P.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:x.vH.Down,keyCode:x.AY.VolumeDown,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:x.vH.Up,keyCode:x.AY.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!ed.running,iconProps:{iconName:P.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;ed.fullScreenContainer.focus(),await (null===(e=ed.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:x.vH.Down,keyCode:x.AY.VolumeMute,repeat:0,metaState:0})),await (null===(t=ed.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:x.vH.Up,keyCode:x.AY.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!ed.running,iconProps:{iconName:P.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{ed.fullScreenContainer.focus(),ed.client.controlMessageWriter.rotateDevice()}},{key:"rotateVideoLeft",disabled:!ed.running,iconProps:{iconName:P.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),ed.rotation-=1,ed.rotation<0&&(ed.rotation=3)})},{key:"rotateVideoRight",disabled:!ed.running,iconProps:{iconName:P.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,y.aD)(()=>{ed.fullScreenContainer.focus(),ed.rotation=ed.rotation+1&3})}),e.push({key:"turnScreenOff",disabled:!ed.running,iconProps:{iconName:P.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{ed.fullScreenContainer.focus(),ed.client.controlMessageWriter.setScreenPowerMode(x.Mr.Off)}},{key:"turnScreenOn",disabled:!ed.running,iconProps:{iconName:P.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{ed.fullScreenContainer.focus(),ed.client.controlMessageWriter.setScreenPowerMode(x.Mr.Normal)}}),ed.running&&e.push({key:"fps",text:"FPS: ".concat(ed.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,n.jsx)(D.X,{})},{key:"separator",disabled:!0,itemType:k.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:P.PJ.PanelBottom},canCheck:!0,checked:ed.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,y.aD)(()=>{ed.navigationBarVisible=!ed.navigationBarVisible})},{key:"Log",iconProps:{iconName:P.PJ.TextGrammarError},canCheck:!0,checked:ed.logVisible,text:"Log",iconOnly:!0,onClick:(0,y.aD)(()=>{ed.logVisible=!ed.logVisible})},{key:"DemoMode",iconProps:{iconName:P.PJ.Wand},canCheck:!0,checked:ed.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,y.aD)(()=>{ed.demoModeVisible=!ed.demoModeVisible})}),e}),ec=(0,v.Pi)(function(){return(0,n.jsx)(C.X,{items:el.get()})});var eh=i(8301);let eu=(0,p.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function ep(e){return!!ed.client&&0===e.button&&(ed.fullScreenContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),!0)}function eg(e){return!!ed.client&&0===e.button}function ef(e){ep(e)&&ed.client.controlMessageWriter.backOrScreenOn(x.vH.Down)}function ey(e){eg(e)&&ed.client.controlMessageWriter.backOrScreenOn(x.vH.Up)}function ev(e){ep(e)&&ed.client.controlMessageWriter.injectKeyCode({action:x.vH.Down,keyCode:x.AY.AndroidHome,repeat:0,metaState:0})}function em(e){eg(e)&&ed.client.controlMessageWriter.injectKeyCode({action:x.vH.Up,keyCode:x.AY.AndroidHome,repeat:0,metaState:0})}function ew(e){ep(e)&&ed.client.controlMessageWriter.injectKeyCode({action:x.vH.Down,keyCode:x.AY.AndroidAppSwitch,repeat:0,metaState:0})}function eb(e){eg(e)&&ed.client.controlMessageWriter.injectKeyCode({action:x.vH.Up,keyCode:x.AY.AndroidAppSwitch,repeat:0,metaState:0})}let eS=(0,v.Pi)(function(e){let{className:t,style:i,children:o}=e,r=eu();return ed.navigationBarVisible?(0,n.jsxs)(s.K,{className:(0,eh.z)(r.container,t),verticalFill:!0,horizontalAlign:"center",style:i,children:[o,(0,n.jsxs)(s.K,{className:r.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,n.jsx)(ee.h,{className:(0,eh.z)(r.back,r.icon),iconProps:{iconName:P.PJ.Play},onPointerDown:ef,onPointerUp:ey}),(0,n.jsx)(ee.h,{className:r.icon,iconProps:{iconName:P.PJ.Circle},onPointerDown:ev,onPointerUp:em}),(0,n.jsx)(ee.h,{className:r.icon,iconProps:{iconName:P.PJ.Stop},onPointerDown:ew,onPointerUp:eb})]})]}):(0,n.jsx)("div",{className:t,style:i,children:o})}),ek=(0,p.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function eC(e){if(!ed.client)return;ed.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation();let{x:t,y:i}=ed.clientPositionToDevicePosition(e.clientX,e.clientY);ed.client.controlMessageWriter.injectScroll({screenWidth:ed.client.screenWidth,screenHeight:ed.client.screenHeight,pointerX:t,pointerY:i,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}let ex=[x.Zj.Primary,x.Zj.Tertiary,x.Zj.Secondary,x.Zj.Back,x.Zj.Forward];function eP(e,t){let i;if(!ed.client)return;let{pointerType:o}=t;i="mouse"===o?x.YF.Finger:BigInt(t.pointerId);let{x:n,y:r}=ed.clientPositionToDevicePosition(t.clientX,t.clientY),a=ed.hoverHelper.process({action:e,pointerId:i,screenWidth:ed.client.screenWidth,screenHeight:ed.client.screenHeight,pointerX:n,pointerY:r,pressure:t.pressure,actionButton:ex[t.button],buttons:t.buttons});for(let e of a)ed.client.controlMessageWriter.injectTouch(e)}function eD(e){ed.client&&(ed.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),eP(x.DC.Down,e))}function eL(e){ed.client&&(e.preventDefault(),e.stopPropagation(),eP(0===e.buttons?x.DC.HoverMove:x.DC.Move,e))}function eE(e){ed.client&&(e.preventDefault(),e.stopPropagation(),eP(x.DC.Up,e))}function e_(e){ed.client&&(e.preventDefault(),e.stopPropagation(),eP(x.DC.HoverExit,e),eP(x.DC.Up,e))}function eA(e){e.preventDefault()}function eO(){let e=ek(),[t,i]=(0,b.useState)(null);return(0,b.useEffect)(()=>{if(ed.setRendererContainer(t),t)return t.addEventListener("wheel",eC,{passive:!1}),()=>{t.removeEventListener("wheel",eC)}},[t]),(0,n.jsx)("div",{ref:i,className:e.video,style:{width:ed.width,height:ed.height,transform:"translate(".concat((ed.rotatedWidth-ed.width)/2,"px, ").concat((ed.rotatedHeight-ed.height)/2,"px) rotate(").concat(90*ed.rotation,"deg)")},onPointerDown:eD,onPointerMove:eL,onPointerUp:eE,onPointerCancel:eE,onPointerLeave:e_,onContextMenu:eA})}let ez=(e,t,i,o,n)=>{(0,b.useEffect)(()=>{let n="function"==typeof e?e():e;return n.addEventListener(t,i,o),()=>n.removeEventListener(t,i,o)},n)},ej=b.useLayoutEffect;Symbol("UNINITIALIZED");let eT="undefined"!=typeof localStorage?function(e,t){var i;let[o,n]=(0,b.useState)(()=>localStorage.getItem(e)||t);ez(globalThis,"storage",()=>n(null!==(i=localStorage.getItem(e))&&void 0!==i?i:t),{passive:!0},[e,t]);let r=function(e){let t=function(e){let t=(0,b.useRef)(e);return ej(()=>{t.current=e},[e]),t}(e);return function(e){let t=(0,b.useRef)(e);return t.current}(function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t.current(...i)})}(t=>{n(t),localStorage.setItem(e,t)});return[o,r]}:(e,t)=>[t,()=>{}],eM=(0,p.Z)({layerHost:{position:"absolute",top:0,bottom:0,left:0,right:0,pointerEvents:"none",...g.q5.margin(0)},fullScreenContainer:{flexGrow:1,display:"flex",flexDirection:"column",backgroundColor:"black",":focus-visible":{...g.q5.outline("0")}},fullScreenStatusBar:{display:"flex",color:"white",columnGap:"12px",...g.q5.padding("8px","20px")},spacer:{flexGrow:1}}),eV=(0,v.Pi)(()=>{let e=eM(),t=(0,u.M)("layerHost"),[i,o]=(0,b.useState)(!1);return((0,b.useEffect)(()=>{o(!0)},[]),i)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{id:t,className:e.layerHost}),(0,n.jsx)(a.V,{hidden:!ed.connecting,modalProps:{layerProps:{hostId:t}},dialogContentProps:{title:"Connecting..."},children:(0,n.jsxs)(s.K,{tokens:P.WT,children:[(0,n.jsx)(d.Y,{label:"Downloading scrcpy server...",percentComplete:ed.serverTotalSize?ed.serverDownloadedSize/ed.serverTotalSize:void 0,description:(0,P.CY)(ed.debouncedServerDownloadedSize,ed.serverTotalSize,ed.serverDownloadSpeed)}),(0,n.jsx)(d.Y,{label:"Pushing scrcpy server to device...",progressHidden:0===ed.serverTotalSize||ed.serverDownloadedSize!==ed.serverTotalSize,percentComplete:ed.serverUploadedSize/ed.serverTotalSize,description:(0,P.CY)(ed.debouncedServerUploadedSize,ed.serverTotalSize,ed.serverUploadSpeed)}),(0,n.jsx)(d.Y,{label:"Starting scrcpy server on device...",progressHidden:0===ed.serverTotalSize||ed.serverUploadedSize!==ed.serverTotalSize})]})})]}):null});async function eR(e){if(!ed.client)return;e.preventDefault(),e.stopPropagation();let{type:t,code:i}=e;ed.keyboard["keydown"===t?"down":"up"](i)}function eN(){var e;ed.client&&(null===(e=ed.keyboard)||void 0===e||e.reset())}let eI=(0,v.Pi)(function(e){var t;let{keyboardLockEnabled:i}=e,o=eM(),[r,a]=eT("scrcpy-hint-hidden","false");return i&&ed.isFullScreen&&"true"!==r?(0,n.jsxs)("div",{className:o.fullScreenStatusBar,children:[(0,n.jsx)("div",{children:null===(t=N.d.device)||void 0===t?void 0:t.serial}),(0,n.jsxs)("div",{children:["FPS: ",ed.fps]}),(0,n.jsx)("div",{className:o.spacer}),(0,n.jsx)("div",{children:"Press and hold ESC to exit full screen"}),(0,n.jsx)(l.r,{onClick:()=>a("true"),children:"Don't show again"})]}):null});var eH=(0,v.Pi)(()=>{let e=eM();(0,b.useEffect)(()=>{1===er.decoders.length&&f.H.isSupported()&&(0,y.z)(()=>{er.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:f.H})})},[]);let[t,i]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{if("keyboard"in navigator)return navigator.keyboard.lock(),i(!0),()=>{navigator.keyboard.unlock()}},[]),(0,b.useEffect)(()=>(window.addEventListener("blur",eN),()=>{window.removeEventListener("blur",eN)}),[]),(0,n.jsxs)(s.K,{...P.LE,children:[(0,n.jsx)(w(),{children:(0,n.jsx)("title",{children:"Scrcpy - Tango"})}),ed.running?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec,{}),(0,n.jsxs)(s.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,n.jsxs)("div",{ref:ed.setFullScreenContainer,className:e.fullScreenContainer,tabIndex:0,onKeyDown:eR,onKeyUp:eR,children:[(0,n.jsx)(eI,{keyboardLockEnabled:t}),(0,n.jsx)(S.wM,{width:ed.rotatedWidth,height:ed.rotatedHeight,BottomElement:eS,children:(0,n.jsx)(eO,{})})]}),(0,n.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:ed.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:ed.log.map((e,t)=>(0,n.jsx)("div",{children:e},t))}),(0,n.jsx)(S.bq,{style:{display:ed.demoModeVisible?"block":"none"}})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(S.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"can mirror device display and audio with low latency and control the device, all without root access."]}),(0,n.jsx)("div",{children:"This is a TypeScript re-implementation of the client part. Paired with official pre-built server binary."}),(0,n.jsx)(c.v,{align:"start",children:(0,n.jsx)(h.K,{text:"Start",disabled:!N.d.adb,onClick:ed.start})}),es.get().map(e=>(0,n.jsx)(eo,{definition:e,value:er[e.group][e.key],onChange:(0,y.aD)((e,t)=>er[e.group][e.key]=t)},e.key)),(0,n.jsx)(eV,{})]})]})})}},function(e){e.O(0,[69,937,297,774,888,179],function(){return e(e.s=6685)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-8b0d76459dd1fd5c.js.map